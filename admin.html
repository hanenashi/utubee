<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>utubee admin</title>
  <style>
    body{margin:0;background:#0b0b0f;color:#e9e9ee;font-family:system-ui,-apple-system,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:16px 16px 40px}
    h2{margin:0 0 10px}
    .hint{opacity:.7;font-size:13px;margin:6px 0 14px}
    
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0}
    .btn{
      padding:10px 14px;border-radius:10px;cursor:pointer;user-select:none;
      border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.10); color:inherit;
    }
    .btn:hover{background:rgba(255,255,255,.15)}
    .btn.primary{background:rgba(90,140,255,.2);border-color:rgba(90,140,255,.4)}
    
    .panel{
      border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04);
      border-radius:16px; padding:16px; margin-bottom: 20px;
    }
    .panel h3{margin:0 0 10px;font-size:15px;opacity:.9}

    textarea, input[type="text"]{
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      border-radius:10px; color:#e9e9ee; width:100%; box-sizing:border-box;
      padding:10px; margin-bottom: 10px; display:block;
    }
    textarea{min-height:100px; font-family:monospace; font-size:12px;}

    /* List Items */
    .list{display:flex;flex-direction:column;gap:8px}
    .item{
      display:grid; grid-template-columns: 30px 60px 1fr 60px; gap:12px;
      align-items:center; padding:8px; border-radius:10px;
      background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);
    }
    .handle{cursor:grab; opacity:.5; text-align:center;}
    .thumb{width:60px; height:34px; background:#000; object-fit:cover; display:block; border-radius:4px;}
    .info{min-width:0;}
    .title{font-size:13px; font-weight:bold; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .meta{font-size:11px; opacity:.6; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .type-badge{
      display:inline-block; font-size:9px; padding:2px 5px; border-radius:4px;
      text-transform:uppercase; margin-right:6px; vertical-align:middle;
    }
    .tb-vid{background:rgba(255,0,0,0.3); color:#ffbfbf;}
    .tb-gal{background:rgba(0,255,100,0.2); color:#bfffda;}

    /* Tabs */
    .tabs{display:flex; gap:10px; margin-bottom:10px; border-bottom:1px solid rgba(255,255,255,.1); padding-bottom:10px;}
    .tab{opacity:.5; cursor:pointer; padding:4px 8px;}
    .tab.active{opacity:1; font-weight:bold; border-bottom:2px solid #fff;}

    pre{padding:12px; background:#000; overflow:auto; border-radius:10px;}
  </style>
</head>
<body>
<div class="wrap">
  <h2>utubee admin (Mixed Content)</h2>
  
  <div class="panel">
    <h3>1) Load Content</h3>
    <div class="row">
      <div class="btn primary" id="load">Load content.json</div>
      <div class="btn" id="clear">Clear List</div>
      <span class="hint" id="status"></span>
    </div>
  </div>

  <div class="panel">
    <h3>2) Add Item</h3>
    <div class="tabs">
      <div class="tab active" data-mode="video">Add Video</div>
      <div class="tab" data-mode="gallery">Add Gallery</div>
    </div>

    <div id="formVideo">
      <div class="hint">Paste YouTube links (one per line)</div>
      <textarea id="taVid" placeholder="https://youtu.be/..."></textarea>
      <div class="btn primary" id="addVid">Add Videos</div>
    </div>

    <div id="formGallery" hidden>
      <input type="text" id="galTitle" placeholder="Gallery Title (e.g. Summer Trip)">
      <div class="hint">Paste Image URLs (one per line)</div>
      <textarea id="taGal" placeholder="https://host.com/img1.jpg..."></textarea>
      <div class="btn primary" id="addGal">Create Gallery</div>
    </div>
  </div>

  <div class="panel">
    <h3>3) Organize</h3>
    <div class="list" id="list"></div>
  </div>

  <div class="panel">
    <h3>4) Export</h3>
    <div class="btn primary" id="gen">Generate JSON</div>
    <pre id="out"></pre>
  </div>
</div>

<script>
  let items = []; // Can contain Strings (URL) or Objects (Gallery)

  // -- Utils --
  function parseVideoId(input){
    const s = String(input||"").trim();
    if(!s) return null;
    if(/^[a-zA-Z0-9_-]{8,15}$/.test(s) && !s.includes("http")) return s;
    try{
      const u = new URL(s);
      if(u.hostname.includes("youtu.be")) return u.pathname.replace("/","") || null;
      if(u.hostname.includes("youtube.com")){
        if(u.searchParams.get("v")) return u.searchParams.get("v");
      }
    }catch{}
    return null;
  }

  function genId(){ return "g_" + Math.random().toString(36).substr(2, 6); }

  function renderList(){
    const elList = document.getElementById("list");
    elList.innerHTML = "";
    document.getElementById("status").textContent = `${items.length} items`;

    items.forEach((item, idx) => {
      const div = document.createElement("div");
      div.className = "item";
      div.draggable = true;
      
      let thumb = "", title = "", meta = "", badge = "";
      
      if(typeof item === "string"){
        // Video
        const vid = parseVideoId(item);
        thumb = `<img class="thumb" src="https://i.ytimg.com/vi/${vid}/default.jpg">`;
        title = vid;
        meta = item;
        badge = `<span class="type-badge tb-vid">VID</span>`;
      } else {
        // Gallery
        const img = item.images[0] || "";
        thumb = `<img class="thumb" src="${img}">`;
        title = item.title;
        meta = `${item.images.length} images`;
        badge = `<span class="type-badge tb-gal">GAL</span>`;
      }

      div.innerHTML = `
        <div class="handle">☰</div>
        ${thumb}
        <div class="info">
          <div class="title">${badge} ${title}</div>
          <div class="meta">${meta}</div>
        </div>
        <div class="btn" style="padding:4px 8px;font-size:11px">✕</div>
      `;
      
      // Remove
      div.querySelector(".btn").onclick = () => {
        items.splice(idx, 1);
        renderList();
      };

      // Drag / Drop (Simple reorder)
      div.addEventListener("dragstart", e => { e.dataTransfer.setData("idx", idx); });
      div.addEventListener("dragover", e => e.preventDefault());
      div.addEventListener("drop", e => {
        e.preventDefault();
        const from = e.dataTransfer.getData("idx");
        const moved = items.splice(from, 1)[0];
        items.splice(idx, 0, moved);
        renderList();
      });

      elList.appendChild(div);
    });
  }

  // -- Event Listeners --
  document.getElementById("load").onclick = async () => {
    try {
      const res = await fetch("content.json", {cache:"no-store"});
      const data = await res.json();
      items = data.items || [];
      renderList();
    } catch { alert("Could not load content.json"); }
  };

  document.getElementById("clear").onclick = () => { items=[]; renderList(); };

  // Tabs
  const tabs = document.querySelectorAll(".tab");
  tabs.forEach(t => t.onclick = () => {
    tabs.forEach(x => x.classList.remove("active"));
    t.classList.add("active");
    document.getElementById("formVideo").hidden = (t.dataset.mode !== "video");
    document.getElementById("formGallery").hidden = (t.dataset.mode !== "gallery");
  });

  // Add Video
  document.getElementById("addVid").onclick = () => {
    const lines = document.getElementById("taVid").value.split("\n");
    lines.forEach(l => {
      const id = parseVideoId(l);
      if(id) items.push(`https://youtu.be/${id}`);
    });
    document.getElementById("taVid").value = "";
    renderList();
  };

  // Add Gallery
  document.getElementById("addGal").onclick = () => {
    const title = document.getElementById("galTitle").value.trim();
    const rawImgs = document.getElementById("taGal").value.split("\n").map(s=>s.trim()).filter(Boolean);
    
    if(!title || !rawImgs.length) return alert("Title and Images required");

    items.push({
      type: "gallery",
      id: genId(), // Generate stable ID on creation
      title: title,
      images: rawImgs
    });

    document.getElementById("galTitle").value = "";
    document.getElementById("taGal").value = "";
    renderList();
  };

  // Export
  document.getElementById("gen").onclick = () => {
    const json = JSON.stringify({ items: items }, null, 2);
    document.getElementById("out").textContent = json;
    navigator.clipboard.writeText(json).then(()=>alert("Copied to clipboard!"));
  };

  renderList();
</script>
</body>
</html>