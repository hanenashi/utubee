<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>utubee</title>
  <style>
    body{margin:0;background:#0b0b0f;color:#e9e9ee;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    header{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.1);position:sticky;top:0;background:rgba(10,10,14,.9);backdrop-filter:blur(8px);z-index:5}
    .wrap{max-width:1200px;margin:0 auto;padding:14px 16px 40px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{border:1px solid rgba(255,255,255,.1);border-radius:16px;overflow:hidden;background:rgba(255,255,255,.04)}
    .thumb{position:relative;aspect-ratio:16/9;cursor:pointer;background:#111}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .play{position:absolute;inset:0;display:grid;place-items:center;background:linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,.05))}
    .play span{width:56px;height:56px;border-radius:999px;display:grid;place-items:center;background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.22)}
    .play svg{width:18px;height:18px;fill:#fff;margin-left:2px}
    .meta{padding:10px 12px 12px;font-size:12px;opacity:.85;word-break:break-all}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:50;padding:18px}
    .overlay.on{display:flex}
    .player{width:min(1100px,96vw);aspect-ratio:16/9;background:#000;border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,.12);position:relative}
    .close{position:absolute;top:10px;right:10px;padding:8px 10px;border-radius:12px;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.16);color:#fff;cursor:pointer;z-index:3}
    .player iframe{width:100%;height:100%;border:0;display:block}
    .status{font-size:12px;opacity:.8;margin:10px 0 14px}
    a{color:#b7d0ff}
  </style>
</head>
<body>
<header><b>utubee</b></header>

<div class="wrap">
  <div class="status">
    Admin page: <a href="./admin.html">admin.html</a>
  </div>
  <div id="grid" class="grid"></div>
</div>

<div id="overlay" class="overlay">
  <div class="player">
    <div class="close" id="close">Close (Esc)</div>
    <div id="slot"></div>
  </div>
</div>

<script>
  function parseVideoId(input){
    const s = String(input||"").trim();
    if(!s) return null;
    if(/^[a-zA-Z0-9_-]{8,15}$/.test(s) && !s.includes("http")) return s;
    try{
      const u = new URL(s);
      if(u.hostname.includes("youtu.be")) return u.pathname.replace("/","") || null;
      if(u.hostname.includes("youtube.com")){
        if(u.searchParams.get("v")) return u.searchParams.get("v");
        const m = u.pathname.match(/\/shorts\/([^/]+)/); if(m) return m[1];
        const e = u.pathname.match(/\/embed\/([^/]+)/); if(e) return e[1];
      }
    }catch{}
    return null;
  }

  const grid = document.getElementById("grid");
  const overlay = document.getElementById("overlay");
  const slot = document.getElementById("slot");
  const closeBtn = document.getElementById("close");

  function play(id){
    slot.innerHTML = `
      <iframe
        src="https://www.youtube-nocookie.com/embed/${id}?autoplay=1&rel=0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
        allowfullscreen
        title="YouTube player"></iframe>`;
    overlay.classList.add("on");
  }
  function close(){
    overlay.classList.remove("on");
    slot.innerHTML = "";
  }
  overlay.addEventListener("click", e => { if(e.target===overlay) close(); });
  closeBtn.addEventListener("click", close);
  window.addEventListener("keydown", e => { if(e.key==="Escape" && overlay.classList.contains("on")) close(); });

  async function init(){
    let data;
    try{
      const res = await fetch("./videos.json", {cache:"no-store"});
      data = await res.json();
    }catch(err){
      grid.innerHTML = "<div class='status'>Couldn't load videos.json. Did you create it?</div>";
      return;
    }

    const urls = data.videos || [];
    const ids = urls.map(parseVideoId).filter(Boolean);

    if(!ids.length){
      grid.innerHTML = "<div class='status'>No valid videos in videos.json yet.</div>";
      return;
    }

    for(const id of ids){
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="thumb">
          <img loading="lazy" src="https://i.ytimg.com/vi/${id}/hqdefault.jpg" alt="">
          <div class="play"><span><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></span></div>
        </div>
        <div class="meta">${id}</div>`;
      card.querySelector(".thumb").addEventListener("click", ()=>play(id));
      grid.appendChild(card);
    }
  }
  init();
</script>
</body>
</html>
