:root{
  --minTile: 220px;
  --gap: 14px;
  --borderW: 1px;
}

body{
  margin:0; background:#0b0b0f; color:#e9e9ee;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  overflow-y: scroll;
}

.wrap{ max-width:1200px; margin:0 auto; padding:14px 16px 40px; box-sizing: border-box; }

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(var(--minTile), 1fr));
  gap:var(--gap);
}

.card{
  border-radius:16px; overflow:hidden;
  background:rgba(255,255,255,.04);
  box-shadow:0 8px 26px rgba(0,0,0,.35);
  transition: opacity 0.2s;
}

.tile{
  position:relative; 
  aspect-ratio:16/9; 
  background:#000;
  border: var(--borderW) solid transparent; 
  cursor: pointer;
  -webkit-touch-callout: none; -webkit-user-select: none;
  user-select: none; touch-action: manipulation;
}

.card.state-unseen .tile{ border-color: rgba(120,255,120,0.92); }
.card.state-partial .tile{ border-color: rgba(255,170,70,0.92); }
.card.state-seen .tile{ border-color: transparent; }

.tile.pressing{ outline:2px solid rgba(255,255,255,.18); outline-offset:-2px; }

.tile img.vid-thumb{ width:100%; height:100%; object-fit:cover; display:block; }

.tile.gallery-tile{
  height: 100%; overflow: hidden;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(2, 1fr);
  gap: 2px; padding: 2px;
  background: #000; box-sizing: border-box; 
}
.tile.gallery-tile img{
  width:100%; height:100%; object-fit: cover; 
  border-radius: 2px; background: #1a1a1a; display: block;
}

.play{
  position:absolute; inset:0; display:grid; place-items:center;
  background:linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,.05));
}
.play span{
  width:56px; height:56px; border-radius:999px;
  display:grid; place-items:center;
  background:rgba(255,255,255,.14); border:1px solid rgba(255,255,255,.22);
}
.play svg{ width:18px; height:18px; fill:#fff; margin-left:2px; }

.player{ width:100%; height:100%; border:0; display:block; }
.x{
  position:absolute; top:8px; right:8px;
  padding:6px 9px; border-radius:12px;
  background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.16);
  color:#fff; cursor:pointer; font-size:12px; line-height:1; z-index:3;
}

/* --- LAYERS --- */
.layer{
  position: fixed; inset: 0; background: #0b0b0f;
  z-index: 500; overflow-y: auto;
  display: flex; flex-direction: column;
}
.layer[hidden]{ display:none; }
.layer .wrap { width: 100%; }

.layer-header{
  position: sticky; top:0;
  background: rgba(11,11,15,0.95); backdrop-filter: blur(10px);
  padding: 14px 16px;
  display: flex; align-items: center; gap: 16px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  z-index: 10;
}
.btn-back{
  padding: 8px 14px; background: rgba(255,255,255,0.1);
  border-radius: 8px; font-size: 13px; cursor: pointer; user-select: none;
}
.btn-back:hover{ background: rgba(255,255,255,0.15); }
.layer-header h2{ margin:0; font-size: 18px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Lightbox */
.lightbox-layer{
  background: #000; z-index: 600; 
  display: flex; align-items: center; justify-content: center;
  outline: none; overflow: hidden;
  touch-action: none; /* Disable native pan/zoom on mobile */
}
.lb-img-wrap{
  width: 100%; height: 100%;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
}
.lb-img-wrap img{
  width: auto; height: auto;
  max-width: 100%; max-height: 100%;
  object-fit: contain;
  user-select: none;
  -webkit-user-drag: none; /* KEY FIX: Kills ghost image drag */
  cursor: zoom-in;
  transition: transform 0.1s cubic-bezier(0.1, 0.7, 1.0, 0.1);
  will-change: transform;
}
.lb-img-wrap img.zooming{
  cursor: grab;
  /* We do NOT remove max-width here anymore, relying on scale() instead */
  transition: none;
}

.lb-ctrl{
  position: absolute; top: 50%; transform: translateY(-50%);
  width: 80px; height: 100%;
  display: flex; align-items: center; justify-content: center;
  font-size: 40px; color: rgba(255,255,255,0.5);
  cursor: pointer; user-select: none; transition: color 0.2s;
}
.lb-ctrl:hover{ color: #fff; background: rgba(255,255,255,0.05); }
.lb-ctrl.prev{ left: 0; }
.lb-ctrl.next{ right: 0; }

.lb-close{
  position: absolute; top: 20px; right: 20px;
  width: 48px; height: 48px; display: grid; place-items: center;
  background: rgba(255,255,255,0.15); border-radius: 50%; cursor: pointer;
}
.lb-count{ position: absolute; bottom: 20px; font-size: 13px; opacity: 0.6; pointer-events:none; }

/* Settings UI */
.gear{
  position:fixed; right:14px; top:14px;
  width:40px; height:40px; border-radius:14px;
  display:grid; place-items:center;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.08); backdrop-filter:blur(8px);
  cursor:pointer; user-select:none; z-index:40;
}
.panel{
  position:fixed; right:14px; top:60px;
  width:min(360px,calc(100vw - 28px));
  border-radius:16px; border:1px solid rgba(255,255,255,.14);
  background:rgba(10,10,14,.92); backdrop-filter:blur(10px);
  padding:12px; display:none; z-index:1000;
  box-shadow:0 12px 40px rgba(0,0,0,.45);
}
.panel.on{ display:block }
.panel h3{ margin:4px 0 10px; font-size:14px; opacity:.95; }
.row{ display:flex; align-items:center; justify-content:space-between; margin:10px 0; gap:10px; }
.row label{ font-size:12px; opacity:.85 }
.row .val{ font-size:12px; opacity:.75; min-width:54px; text-align:right }
input[type="range"]{ width:190px }
.btns{ display:flex; gap:10px; margin-top:10px; }
.btn{ flex:1; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.10); text-align:center; cursor:pointer; font-size:12px; user-select:none; }
.btn:hover{ background:rgba(255,255,255,.13) }
.btn.ghost{ background:transparent }
.btn.danger{ background:rgba(255,90,90,.14); border-color:rgba(255,90,90,.28); }
.hint{ margin-top:8px; font-size:12px; opacity:.7; line-height:1.35; }